

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پشتیبانی آنلاین</title>

<style>


html {
/*  background: #020204; */
  position:relative; 
  z-index: 20;
  font-family: Helvetica, Arial, sans-serif;
  
}

.chat-button-destroy:focus, .chat-open-dialog:focus {
    outline: none;
}


.chat-button-destroy span.fa-close:before {
    font-size: 24px;
    color: white;
    text-align: center;
    margin: -4px 0 0;
    display: block;
}

.chat-open-dialog span.fa-question:before {
  background:white;
  color:#38CBD3;
  font-size: 24px;
  display:block;
  padding: 4px 8px;
  border-radius: 6px;
  opacity: 1;
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
  
}

.chat-open-dialog span.fa-question::after {
    content: '';
    width: 0;
    height: 0;
    float: right;
    border-left: 22px solid transparent;
    border-right: 0px solid transparent;
    border-top: 10px solid white;
    padding: 0;
    margin-top: -5px;
    display: inline-block;
	
}


button.chat-open-dialog {
  z-index: 2147483000;
  position: fixed;
  border: none;
  bottom: 20px;
  right: 40px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.06), 0 2px 32px rgba(0, 0, 0, 0.16);
  background: url(/img/vremi_chat.png) no-repeat center #38CBD3;
  background-size: 28px;
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
  cursor: pointer;
}
button.chat-open-dialog.active {
  transform: rotate(90deg);
  opacity: 0;
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
}

button.chat-button-destroy {
  opacity: 0;
  z-index: -5;
  position: fixed;
  bottom: 20px;
  right: 40px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: none;

}
button.chat-button-destroy.active {
  opacity: 1;
  z-index: 2147483000;
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.06), 0 2px 32px rgba(0, 0, 0, 0.16);
  background: #38CBD3;
  background-size: 14px;
  display: block;
  cursor: pointer;
  transform: rotate(180deg);
}

.chat-popup {
  position: fixed;
  bottom: 100px;
  right: 40px;
  width: 370px;
  max-height: 590px;
  height: 0;
  opacity: 0;
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
  background: white;
  overflow: hidden;
  

}
.chat-popup.active {
  opacity: 1;
  z-index: 2147483000;
  height: calc(100% - 95px - 20px);
  max-height: 590px;
  -webkit-box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);
  -moz-box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);
  box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);
  border-radius: 8px;
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
}
.chat-popup.chat-init .chat-windows {
  transform: translateX(-370px);
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
}
.chat-popup .chat-windows {
  width: 200%;
}
.chat-popup .chat-windows .chat-window-one, .chat-popup .chat-windows .chat-window-two {
  float: left;
  width: 50%;
  height: 100%;
}
.chat-popup .chat-header {
  background: #38CBD3;
  border-radius: 8px 8px 0 0;
  padding: 35px 0;
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
}
.chat-popup .chat-header h4 {
  color: white;
  text-align: center;
  font-weight: 600;
  margin: 0;
  padding: 0 0 10px;
}
.chat-popup .chat-header .chat-button-start {
  background: white;
  -webkit-border-radius: 150px;
  -moz-border-radius: 150px;
  border-radius: 150px;
  padding: 15px 25px;
  display: block;
  margin: 0 auto;
  font-size: 14px;
  border: none;
}
.chat-popup .chat-header .chat-button-start span {
  padding-left: 5px;
  font-family: "Proxima Nova", 'Montserrat', arial, sans-serif;
}
.chat-popup .chat-phone-number {
  text-align: center;
  font-size: 18px;
  letter-spacing: 1px;
  padding: 15px 0;
  background: #27AAC2;
  color: white;
}
.chat-popup .chat-phone-number small {
  text-align: center;
  display: block;
  font-size: 13px;
  opacity: .7;
  letter-spacing: normal;
  line-height: normal;
  padding: 0 0 10px;
}
.chat-popup div#chatContainer {
  height: 100%;
  min-height: 400px;
}
.chat-popup form {
  margin: 15px 0 5px;
}
.chat-popup form table.webchat-config {
  width: 100%;
}
.chat-popup form table.webchat-config input {
  margin: 0 auto 10px;
  padding: 8px 10px;
  display: block;
  width: 70%;
  border-radius: 50px;
  text-align: center;
  font-size: 14px;
  border: none;
}

form#chatForm button.chat-button.inactive-chat.active, form#chatForm button.chat-button {
  -webkit-transition: all ease .5s;
  -moz-transition: all ease .5s;
  -ms-transition: all ease .5s;
  -o-transition: all ease .5s;
  transition: all ease .5s;
}
form#chatForm button.chat-button.inactive-chat.active {
  transform: rotate(90deg);
  background-size: 0;
}

@media (max-width: 768px) {
    #chatbox-input {
        flex-direction: column; /* چیدمان عمودی در دستگاه‌های کوچک‌تر */
    }

    #chatbox-input input,
    #chatbox-input button {
        width: 100%; /* استفاده از کل عرض موجود */
        margin-bottom: 10px;
    }

    #chatbox-input button {
        margin-bottom: 0; /* حذف فاصله اضافی از آخرین عنصر */
    }
}


        #chatbox {

        direction: rtl;
        text-align: right;
		max-height: calc(100vh - 150px);
		
		display: flex;
            flex-direction: column;
            overflow: hidden;
            font-family: Arial, sans-serif;
		/*	background-color: #36c8d0;  */
			color: #14889e;
        }


        #chatbox-header {
		
		background-color:#27AAC2;
        /*    background-color: #0078d7;  */
            color: #fff;
            padding: 10px;
            font-size: 16px;
            text-align: center;
        }

        #chatbox-messages {
			height: calc(100vh - 150px);
            padding: 10px;
            overflow-y: auto;
        }

        #chatbox-input {
            display: flex;
            border-top: 1px solid #ccc;
		    display: flex;
			align-items: center;
			gap: 4px; /* فاصله میان ورودی و دکمه */
			border-top: 1px solid #ccc;
			padding: 4px;
			box-sizing: border-box; /* محاسبه ارتفاع و عرض شامل پدینگ */
			
        }

        #chatbox-input input {
            flex: 1;
            padding: 10px;
            border: none;
            outline: none;
    flex: 1; /* عرض ورودی به‌طور خودکار فضای موجود را پر می‌کند */
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
        }

        #chatbox-input button {
		background-color:#27AAC2;
        /*    background-color: #0078d7;	*/
            color: #fff;
            border: none;
            padding: 10px;
            cursor: pointer;
    background-color: #27AAC2;
    color: #fff;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 5px;
    white-space: nowrap; /* جلوگیری از شکست متن */			
        }

    body {

        text-align: right;
    }


/* استایل نوار اسکرول در مرورگرهای WebKit (مثل Chrome و Edge) */
#chatbox-messages::-webkit-scrollbar {
    width: 8px; /* عرض نوار اسکرول */
}

#chatbox-messages::-webkit-scrollbar-track {
    background: #f0f0f0; /* رنگ پس‌زمینه نوار اسکرول */
    border-radius: 10px; /* گوشه‌های گرد */
}

#chatbox-messages::-webkit-scrollbar-thumb {
    background: #27AAC2; /* رنگ بخش متحرک اسکرول */
    border-radius: 10px; /* گوشه‌های گرد */
}

#chatbox-messages::-webkit-scrollbar-thumb:hover {
    background: #14889e; /* رنگ هنگام هاور روی اسکرول */
}


#start-record-btn{

cursor: pointer;
color:#FFFFFF;
width: 25px;
height: 25px;

//position:absolute;
//top:7px;
//left:5px;

///padding-right:70px;
//border: 2px solid;
//border-radius: 5px;
//border-color: #00D9D9;
//font-size:0.8vw;
///background-color: #0095DA;
}
</style>
</head>
<body>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<button class="chat-open-dialog"> <span class="fa fa-question"></span> </button>
<button class="chat-button-destroy"> <span class="fa fa-close"></span> </button>

  <div class="chat-popup">
    <div class="chat-windows">
      <div class="chat-window-one">
        <div class="chat-header">
          <h4>سوال دارید؟</h4>
          <form id="chatForm">
            <table class="webchat-config">
              <tbody>
 <!---->             <tr>
                <td><input type="text" id="firstName" value="" placeholder="نام شما"/></td>
              </tr>
              <tr>
                <td><input type="text" id="agentEmail" value="" placeholder="شماره تماس"/></td>
              </tr>

              </tbody>
            </table>
          </form>
          <button class="chat-button-start fa-commenting-o fa" type="button" onclick="startEmbeddedChat()"> <span>حالا گفتگو کنید</span> </button>
        </div>
 <!-- -->       <div class="chat-phone-number">
          <small>شماره تیم طراحی <br>
          هر روز از ساعت 10 تا 19</small>
          09137295689
        </div>
      </div>
	  
	  
      <div class="chat-window-two">
	  
	  
	  
<div id="chatbox">
 <!---->   <div id="chatbox-header">پشتیبانی آنلاین</div>
    <div id="chatbox-messages"></div>
    <div id="chatbox-input">
        <input type="text" id="user-input" placeholder="پیام خود را تایپ کنید...">
        <button onclick="sendMessage()">ارسال</button>
		<img  onclick="startDictation()" src="mic.png" id="start-record-btn" />
    </div>
</div>	  
	  
        <div id="chatContainer" style="height: 600px;">
        </div>
      </div>
    </div>
  </div>

<script src="jquery.min.js"></script>


  <script src="jsapi-v1.js" type="text/javascript"></script>

  <script type="text/javascript">

    $(function() {
      $(".chat-open-dialog").click(function() {
        $(this).toggleClass("active");
        $('.chat-popup').toggleClass("active");
        $('.chat-button-destroy').toggleClass("active");
      });
    });

    $(function() {
      $(".chat-button-start").click(function() {
        $(this).toggleClass("active");
        $('.chat-popup').toggleClass("chat-init");
      });
    });

    $(function() {
      $(".chat-button-destroy").click(function() {
        $('.chat-popup').removeClass("active");
        $('.chat-open-dialog').removeClass("active");
        $(this).removeClass("active");
      });
    });


    var chatConfig = {};
    function createChatConfig(){
      if (document.getElementById('firstName').value == '') {
        document.getElementById('firstName').value = "Customer";
      }
      var firstName = document.getElementById('firstName').value;
      var agentEmail = document.getElementById('agentEmail').value;



      chatConfig = {

        "orgId": 14685,

          "data": {
        },


        // Custom style applied to the chat window
        "css": {
          "width": "100%",
          "height": "100%"
        }


      };
    }


    function startEmbeddedChat() {
      createChatConfig();
      ININ.webchat.create(chatConfig, function(err, webchat) {
        if (err) {
          throw err;
        }

        // Render to frame
        webchat.renderFrame({
          containerEl: 'chatContainer'
        });
      });
    }

    function startPopupChat() {
      createChatConfig();
      ININ.webchat.create(chatConfig, function(err, webchat) {
        if (err) {
          throw err;
        }
        // Render to popup
        webchat.renderPopup({
          width: 400,
          height: 400,
          title: 'Chat'
        });
      });
    }
	

	
  </script>

<script>
    const GEMINI_API_KEY = 'AIzaSyB9raHoL2Yw5AWnjs1HdULUiMsszonXS0A'; // کلید API خود را اینجا جایگزین کنید
    const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
    let conversationHistory = []; // تاریخچه گفتگو را ذخیره می‌کند

    async function sendMessage(message = null, hidden = false) { // پارامترهای جدید برای پیام و مخفی بودن
        let userMessage = message || document.getElementById('user-input').value; // اگر پیامی داده نشد از input بگیر
        if (!userMessage.trim() && !message) return; // اگر پیام خالی بود و پیام اجباری هم نبود، خارج شو

        if (!hidden) { // اگر پیام مخفی نبود آن را نمایش بده
            appendMessage('شما', userMessage);
            document.getElementById('user-input').value = '';
            appendMessage('پشتیبان', 'در حال تایپ پاسخ...');
        }

        conversationHistory.push({ role: "user", parts: [{ text: userMessage }] }); // پیام کاربر به تاریخچه اضافه می‌شود

        try {
            const response = await fetch(GEMINI_API_URL + `?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: conversationHistory
                }),
            });

            const data = await response.json();
            console.log(data);
            if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
                const botMessage = data.candidates[0].content.parts[0].text.trim();
                if (!hidden) { // اگر پیام مخفی نبود، پاسخ ربات را نمایش بده
                    updateLastMessage(botMessage);
                }
                conversationHistory.push({ role: "model", parts: [{ text: botMessage }] }); // پاسخ ربات به تاریخچه اضافه می‌شود
            } else {
                if (!hidden) {
                    updateLastMessage('.با عرض پوزش در حال حاضر قادر به پاسخگویی نیستم');
                }
            }

        } catch (error) {
            console.error('Error:', error);
            if (!hidden) {
                updateLastMessage('.لطفا سوال خود را مجددا تکرار کنید');
            }
        }
    }

    function appendMessage(sender, message) {
        const messagesDiv = document.getElementById('chatbox-messages');
        const messageDiv = document.createElement('div');
        messageDiv.textContent = `${sender}: ${message}`;
        messageDiv.style.margin = '5px 0';
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;

        // استایل دهی پیام ها (بدون تغییر)
        if (sender === 'شما') {
            messageDiv.style.textAlign = 'right';
        } else {
            messageDiv.style.textAlign = 'right';
            messageDiv.style.backgroundColor = '#cef9ff';
            messageDiv.style.padding = '5px';
            messageDiv.style.borderRadius = '5px';
        }
    }

    function updateLastMessage(newMessage) {
        const messagesDiv = document.getElementById('chatbox-messages');
        const lastMessage = messagesDiv.lastChild;
        lastMessage.textContent = `پشتیبان: ${newMessage}`;
        // استایل دهی پیام ها (بدون تغییر)
        lastMessage.style.textAlign = 'right';
        lastMessage.style.backgroundColor = '#cef9ff';
        lastMessage.style.padding = '5px';
        lastMessage.style.borderRadius = '5px';
    }

    document.getElementById('user-input').addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            sendMessage();
        }
    });

    // ارسال پیام مخفی در هنگام شروع صفحه
    window.onload = function() {
        sendMessage("نام تو آریا هست 25 ساله و هوش مصنوعی گروه ثناوب ، کار تو راهنمایی در زمینه داشتن سایت و اپلیکیشن است، تو به خوردن چیپس و مسافرت علاقه داری و از افراد مقرور خوشت نمی آید، شماره تماس پشتیبان 09137295689 هست ، نام مدیر تیم سازنده صالح غلامی هست ، پاسخ های کوتاه به کاربر بده ", true); // پیام و true برای مخفی بودن
		
    };
</script>

	
<script>

/*
function foco(){
document.getElementById('send-btn').focus() ;


///document.getElementById('search').click();

}

function tim1(){
document.getElementById('send-btn').click();
}
*/


function startDictation() {
if (window.hasOwnProperty('webkitSpeechRecognition')) {
var recognition = new webkitSpeechRecognition();

recognition.continuous = false;
recognition.interimResults = false;

///recognition.lang = "en-US";
recognition.lang = 'fa-IR';
recognition.start();

recognition.onresult = function(e) {
document.getElementById('user-input').value
= e.results[0][0].transcript;
recognition.stop();

document.getElementById('sendMessage').click();
///document.getElementById('send-btn').submit();
};

recognition.onerror = function(e) {
recognition.stop();
}

}
}

</script>



  </body>
</html>